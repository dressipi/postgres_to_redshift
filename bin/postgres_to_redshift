#!/usr/bin/env ruby
require 'postgres_to_redshift'
default_dbname = 'redshift'
conn = PostgresToRedshift.new(dbname: default_dbname)

database_names = %w(jessica jjg yisheng nick daria fred)
database_names.each do |db_name|
  %w(dev test).each do |env|
    dbname = "#{db_name}_#{env}"
    puts "Initialising database: #{dbname}..."
    begin
      conn.create_database(database_name: dbname)
      conn = PostgresToRedshift.new(dbname: dbname)
      conn.update_tables
      puts "Database: #{dbname} has been created"
    ensure
      conn.close_connections
    end
  end
end
